# CScan 项目规划与技术架构

CScan 是一款分布式智能安全扫描系统，能够为用户快速发现、定位、修复组网设备中存在的安全漏洞。

本文包含了 CScan 项目的需求分析、产品设计与技术架构选型，建议阅读[竞品分析](https://note.youdao.com/share/?id=991ed4f0febff08daf5f53c70d3f09ef&type=notebook#/)系列了解友商扫描器的功能与设计。本文是 V1 版本概要设计，囊括了较为完整与粗糙的未来规划。本文包含的需求按照交付周期又分为了短期，中期与长期，分别对应 V1R* 或者 V2R* 版本。本规划并不代表最终的产品设计方案，仅是对于模块需求点进行切割，以供参考。

本文术语包含如下约定：

* 完整项目需求分为多个模块，每个模块包含多个 Story，每个 Story 描述端到端的需求设计。

* 使用 Level 0 表示短期规划，使用 Level 1 表示中期规划，使用 Level 2 表示长期规划。

# 安全模块

## 组件与漏洞

所谓组件，即表示 Linux，CMS，路由器等被攻击的组件。

* 组件扁平化排布界面 `Level 0`

参考 VulScan 的 CMS 列表或者[知道创宇的组件列表](https://www.seebug.org/appdir/)。

* 组件更新高亮显示 `Level 2`

未来考虑对于最新更新的漏洞，可以进行高亮展示。

* 组件选择弹窗 `Level 0`

该弹窗能够根据组件类型、组件名，快速过滤选择出某个具体的组件。

点击该组件可以进入该组件关联的漏洞列表。

该弹窗可能会嵌套到其他界面中（譬如 POC 筛选界面）。

* (组件关联的)漏洞列表 `Level 0`

点击某个组件，可以进入到该组件关联的漏洞列表。

该漏洞列表也可以独立展示，漏洞列表包含列可以参考[这里](https://www.seebug.org/appdir/Apache%20Tomcat)。

* 漏洞详情界面 `Level 0`

参考 VulScan 中的漏洞详情界面，该漏洞详情界面是通用界面，能够在多处复用。

漏洞详情界面应该包含漏洞关联的 POC 列表，并且点击该界面能够快速进入创建扫描的界面。

以 PDF 方式显示漏洞详情。

* 漏洞分析界面 `Level 2`

未来考虑在漏洞详情界面添加漏洞相关的分析，目前可以先仅添加链接。

## POC

* POC 框架 `Level 0`

POC 框架为 POC 提供了通用的操作库、语义规范、统一输入输出等支持。

* POC 编写 `Level 0`

针对不同的漏洞，编写相对应的 POC。

* POC 镜像化部署与发布 `Level 1`

鉴于 POC 运行环境的多样性与复杂性，应该使用 Docker 镜像的方式包裹，并且发布 POC。使用多阶段编译模型，尽可能地减少镜像的空间占用。

需要提供云端地，私有化的 Docker Registry，通过 Registry 的方式管理并且发布镜像。

## 安全工具

* 0Day 漏洞工具 `Level 1`

系统可以考虑提供 OpenSSL 等 0Day 漏洞工具，弥补现有 POC 的不足，并且方便用户进行实时检测。

* 组件服务探测 `Level 2`

未来可以考虑添加组件服务探测等模块，为扫描获取辅助支撑信息。

* 资产存活性监控 `Level 2`

考虑添加资产存活性监控模块，即使用 HTTP，Ping 等方式实时监控某个资产是否在线/有效。

## 任务调度

任务调度，负责接收用户定义的扫描，将其分解为实际的 POC 测试任务，并且调度保障任务的执行、接收任务的执行结果。对于任务调度的技术选项与模型架构参考下文-异步弹性任务调度章节。

* 扫描触发执行 `Level 0`

调度系统能够接收扫描的编号，并且开始执行该扫描。

* 扫描分解 `Level 0`

调度系统能够将扫描分解为具体的 POC 任务。

* 任务结果上报 `Level 0`

提供接口，能够接收来自 POC 测试任务的结果。

* 过期任务清理 `Level 0`

提供任务清理的接口，能够自动清理过期的任务与对应的执行器。

能够与定时器模块相结合，定时自动地进行清理工作。

# 终端设备/系统

## 首页

### 菜单栏目

菜单栏目提供了常见的控制功能。

* 顶部菜单 `Level 0`

顶部菜单主要提供信息检索相关的功能。

从左到右分为三个模块，依次为：

1.Logo；

2.仪表盘、组件、POC、报告；

3.帮助文档，通知，用户信息，退出登录；

* 左侧菜单 `Level 0`

左侧菜单主要提供资产与扫描相关操作，从上到下依次为：

1.资产管理，子项目包括，添加资产、资产列表、资产报告

2.扫描任务，子项目包括，创建扫描、扫描列表、扫描配置

3.安全工具，子项目包括，漏洞检测工具

4.设备管理，子项目包括，参数配置，数据更新，操作日志

5.安全预警，子项目包括，预警配置，预警列表

### 数据仪表盘-Dashboard

* 漏洞统计图 `Level 0`

漏洞分为严重（Critical），高危（High），中危（Medium）以及低危（Low）四个层次。

在首页上需要展示出当前系统各个级别漏洞的数目，可以考虑[雷达图](https://ecomfe.github.io/echarts-examples/public/editor.html?c=radar)等形式。

可以考虑以[热力图](https://ecomfe.github.io/echarts-examples/public/editor.html?c=heatmap-cartesian)的方式展示出过去每日不同级别漏洞的发现数目。

* 资产安全状况统计图 `Level 0`

需要展示出包含不同安全级别的资产数目占比，可以考虑[饼图](http://gallery.echartsjs.com/editor.html?c=xHkjKKrz_M)等形式。

需要展示出具体的资产漏洞列表。

* 扫描统计图。 `Level 0`

可以以直方图、点图等方式展示出每日扫描数的变化；或者平均任务的完成时间。

## POC 与漏洞

### POC 列表与检索

* POC 列表 `Level 0`

提供基础的 POC 展示列表。

能够从列表中的项目快速进入扫描创建界面（支持多个项目选择）。

* 关键字检索 `Level 0`

能够根据 POC ID，POC 名称进行筛选。

* 根据组件筛选漏洞 POC `Level 1`

能够利用组件选择弹窗，根据选定的组件，来显示出该组件对应的 POC。

### POC 详情

* POC 关联的漏洞信息 `Level 0`

点击进入 POC 的详情界面，其应该包含该 POC 关联的漏洞信息，可以考虑在漏洞信息界面上稍作修改。

## 用户与权限

* 管理员登录 `Level 0`

基础的需要提供登录界面，与管理员登录的功能。

* 多账户管理 `Level 1`

未来需要支持多账户联动管理。

* RABC 基于角色的权限控制 `Level 2`

未来考虑多账户多权限控制功能。

## 资产

从系统的角度来看，资产是不是又可以分为 Host、Database、CMS、WebService 这几大类，其中 WebService 涵盖了 WebAPI，中间件 CGI，FTP 等。

### 资产管理

* 资产添加 `Level 0`

提供资产添加界面，用户可以添加新的资产。

* 资产列表 `Level 0`

提供资产列表界面，用户可以查看所有的资产列表。

用户可以通过资产列表中的项目快速查看资产关联的（最新）报告。

用户可以通过资产列表中的项目快速创建扫描。

* 资产详情 `Level 0`

点击资产，可以进入资产详情界面，资产详情界面应该包含资产关联的组件列表。

* 资产关联组件 `Level 0`

用户再资产添加界面，能够同时添加该资产关联的组件。

用户在资产详情界面，能够查看该资产关联的组件列表。

* 资产更新 `Level 1`

能够对现有的资产进行编辑。

* 资产批量导入 `Level 1`

提供资产的批量导入功能，能够利用 CSV 等格式快速批量导入资产。

### 安全报告

* 资产安全报告 `Level 1`

用户可以选择为某个/某批资产，生成安全报告。

### 安全预警

* 资产安全预警 `Level 1`

考虑添加资产的安全预警功能，包括预警配置界面与预警列表，安全预警能够根据资产的可用性，以及实时的扫描结果给予责任人不同的预警。

## 设备管理

平台考虑以工控机方式发布终端产品，因此产生了一系列需求。

### 工控机配置

* 工控机硬件配置 `Level 0`

需要对定制的裸机进行硬件配置。

* 工控机环境配置 `Level 0`

需要对工控机安装、 配置操作系统， 以及基础的 Docker 运行环境。

* 工控机系统优化 `Level 0`

需要对工控机的系统进行优化，以尽可能最大化利用系统资源。

### 设备信息配置

* 设备基础信息 `Level 0`

需要提供设备的基础信息查看与配置界面。

### 本地更新

* 对比云端与本地版本 `Level 1`

能够提供完整的云端 POC 列表，并且在列表中显示出  云端版本与本地版本是否存在差异。

列表中的项目支持点击一键升级。

* 本地镜像更新 `Level 1`

支持以镜像为载体，进行本地升级。

## 扫描

扫描是系统的基础功能，一次扫描，即是选择一或多个漏洞 POC，对一或多个资产承载的组件进行的安全检测。一次扫描可以分解为多个 POC-资产关联任务。

### 扫描创建

* 扫描创建 `Level 0`

在扫描创建的界面中，先选择目标资产（一或多个），然后选择 POC（默认全部）。

注意，创建按钮，与开始扫描按钮，要有所区分，可能存在单纯创建而不扫描的情况。

注意，POC 的选择方式可能有很多种，可以默认全部选择，可以根据不同的安全级别选择，可以根据组件/漏洞来选择对应的 POC。

* 定时扫描创建 `Level 1`

未来考虑允许为扫描添加定时运行的特性，即可以延迟运行或者周期性运行。

* 快速扫描创建 `Level 0`

允许用户仅输入 URL/IP 即开始扫描。

### 扫描报告

* 扫描列表 `Level 0`

可以查看全部的扫描列表。

* 扫描状态 `Level 0`

可以查看某个扫描的状态，包括扫描的执行时间、整体进度、已发现的漏洞列表等。

可以以列表化，查看扫描关联任务状态。

### 扫描管理

* 扫描删除 `Level 0`

能够删除某个扫描，删除操作需要

* 扫描重置 `Level 1`

能够重置某个扫描。

重置的扫描需要删除之前的任务，并且重新创建新任务。

* 扫描暂停 `Level 1`

未来考虑可以暂停某个扫描。

* 任务管理 `Level 1`

未来可以允许细粒度地为某个任务添加管理功能。

## 安全工具

* 安全工具 Tab 化展示 `Level 2`

在终端设备中的界面中，允许嵌入多个安全工具，进行自定义扫描。

# 云端管理平台

## POC 管理

* 界面化 POC 添加 `Level 1`

云端管理平台，允许以界面化的方式添加 POC。

* 界面化 POC 更新与删除 `Level 1`

云端管理平台，允许以界面化的方式更新或者删除 POC。

## 智能扫描与数据支撑

* 大数据分析与数据挖掘 `Level 2`

未来考虑，可以引入大数据分析技术，来对漏洞扫描过程中产生的大量数据进行实时分析。

* 基于机器学习的漏洞检测 `Level 2`

未来考虑，引入人工智能与机器学习技术，增强平台的漏洞检测能力。

# 技术架构

## 云地一体化扫描器

![云地一体化扫描器](https://user-images.githubusercontent.com/5803001/38121097-ba19366a-33ff-11e8-9071-be239ce8ff69.png)

## 微服务化扫描器

![微服务化扫描器](https://user-images.githubusercontent.com/5803001/38121098-ba713acc-33ff-11e8-98c7-5d3a0b8ec779.png)

## 异步弹性任务调度

异步非阻塞、任务可控、并发执行、自动容错、弹性可扩展等特性。

![异步弹性任务调度](https://user-images.githubusercontent.com/5803001/38121096-b9e23d5e-33ff-11e8-861b-387406895356.png)
